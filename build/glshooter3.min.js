/*
 * webgl shooting game v0.0.0
 * http://www.dev7.jp
 * 
 * The MIT License (MIT)
 * Copyright © 2014 daishi_hmr, dev7.jp
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy of this software and
 * associated documentation files (the “Software”), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies
 * of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following
 * conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all copies or substantial portions
 * of the Software.
 * 
 * THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */


var gls3={};gls3.W=360,gls3.H=480,gls3.assets={titleFont:"fonts/Teko/Teko-Bold.ttf",uiFont:"fonts/Oxygen/Oxygen-Regular.ttf",numberFont:"fonts/UbuntuMono/UbuntuMono-Bold.ttf",test:{url:"example/cubecolors.js",type:"three"}},tm.define("tm.asset.WebFont",{superClass:"tm.event.EventDispatcher",init:function(a,b){this.superInit();var c=tm.dom.Element("body").create("span");c.style.set("fontFamily","'{0}', 'monospace'".format(b)).set("color","rgba(0, 0, 0, 0)").set("fontSize","40px"),c.text="QW@HhsXJ=/()あいうえお＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝";var d=c.element.offsetWidth,e=tm.dom.Element("head").create("style");e.text="@font-face { font-family: '{0}'; src: url({1}) format('truetype'); }".format(b,a);var f=function(){c.element.offsetWidth!==d?(c.remove(),this.flare("load"),console.debug("webfont loaded",a,b)):setTimeout(f,100)}.bind(this);setTimeout(f,100)}}),tm.asset.Loader.register("ttf",function(a,b){var c=tm.asset.WebFont(a,b);return c}),tm.define("tm.asset.ThreeJSON",{superClass:"tm.event.EventDispatcher",init:function(a){this.superInit(),this.mesh=null,null===tm.asset.ThreeJSON.loader&&(tm.asset.ThreeJSON.loader=new THREE.JSONLoader),tm.asset.ThreeJSON.loader.load(a,function(a,b){b[0].shading=THREE.FlatShading,this.mesh=new THREE.Mesh(a,new THREE.MeshFaceMaterial(b)),this.flare("load")}.bind(this))}}),tm.asset.ThreeJSON.loader=null,tm.asset.Loader.register("three",function(a){var b=tm.asset.ThreeJSON(a);return b}),tm.define("tm.hybrid.HybridApp",{superClass:"tm.display.CanvasApp",init:function(a){this.superInit(a),this.setupThree(),this.background="transparent"},setupThree:function(){this.threeRenderer=new THREE.WebGLRenderer({antialias:!0}),this.element.parentNode&&this.element.parentNode.appendChild(this.threeRenderer.domElement),this.threeCanvas=this.threeRenderer.domElement},fitWindow:function(a){var b=function(){a=void 0===a?!0:a;var b=this.threeCanvas,c=b.style;c.position="absolute",c.margin="auto",c.left="0px",c.top="0px",c.bottom="0px",c.right="0px";var d=b.width/window.innerWidth,e=b.height/window.innerHeight,f=b.height/b.width;d>e?(c.width=innerWidth+"px",c.height=innerWidth*f+"px"):(c.width=innerHeight/f+"px",c.height=innerHeight+"px")}.bind(this);return b(),a&&window.addEventListener("resize",b,!1),tm.display.CanvasApp.prototype.fitWindow.call(this,a)},_update:function(){tm.app.BaseApp.prototype._update.call(this);var a=this.currentScene;this.awake&&a instanceof tm.hybrid.HybridScene&&(this.updater.update(a.three.camera),this.updater.update(a.three))},_draw:function(){tm.display.CanvasApp.prototype._draw.call(this);var a=this.currentScene;a instanceof tm.hybrid.HybridScene&&a.render(this.threeRenderer)},resize:function(a,b){this.threeRenderer.setSize(a,b);var c=this.currentScene;return c instanceof tm.hybrid.HybridScene&&(c.three.camera.aspect=a/b),tm.display.CanvasApp.prototype.resize.call(this,a,b)}}),tm.define("tm.hybrid.HybridScene",{superClass:"tm.app.Scene",init:function(){this.superInit(),this.three=tm.hybrid.HybridScene.Three()},render:function(a){a.render(this.three.scene,this.three.camera.threeObject)}}),tm.define("tm.hybrid.HybridScene.Three",{superClass:"tm.hybrid.ThreeElement",init:function(){this.superInit(),this.scene=new THREE.Scene,this.camera=tm.hybrid.Camera(),this.camera.z=7,this.light=new THREE.DirectionalLight(16777215),this.light.position.set(0,0,1).normalize(),this.scene.add(this.light),this.threeObject=this.scene}}),tm.define("tm.hybrid.ThreeElement",{superClass:"tm.app.Element",init:function(){this.superInit(),this.threeObject=null},addChild:function(a){a.parent&&a.remove(),a.parent=this,this.children.push(a),a instanceof tm.hybrid.ThreeElement&&this.threeObject.add(a.threeObject);var b=tm.event.Event("added");return a.dispatchEvent(b),a},removeChild:function(a){var b=this.children.indexOf(a);if(-1!=b){this.children.splice(b,1),a instanceof tm.hybrid.ThreeElement&&this.threeObject.remove(a.threeObject);var c=tm.event.Event("removed");a.dispatchEvent(c)}}}),tm.hybrid.ThreeElement.prototype.accessor("position",{get:function(){return this.threeObject.position},set:function(a){this.threeObject.position=a}}),tm.hybrid.ThreeElement.prototype.accessor("x",{get:function(){return this.threeObject.position.x},set:function(a){this.threeObject.position.x=a}}),tm.hybrid.ThreeElement.prototype.accessor("y",{get:function(){return this.threeObject.position.y},set:function(a){this.threeObject.position.y=a}}),tm.hybrid.ThreeElement.prototype.accessor("z",{get:function(){return this.threeObject.position.z},set:function(a){this.threeObject.position.z=a}}),tm.hybrid.ThreeElement.prototype.accessor("scale",{get:function(){return this.threeObject.scale},set:function(a){this.threeObject.scale=a}}),tm.hybrid.ThreeElement.prototype.accessor("scaleX",{get:function(){return this.threeObject.scale.x},set:function(a){this.threeObject.scale.x=a}}),tm.hybrid.ThreeElement.prototype.accessor("scaleY",{get:function(){return this.threeObject.scale.y},set:function(a){this.threeObject.scale.y=a}}),tm.hybrid.ThreeElement.prototype.accessor("scaleZ",{get:function(){return this.threeObject.scale.z},set:function(a){this.threeObject.scale.z=a}}),tm.hybrid.ThreeElement.prototype.accessor("rotation",{get:function(){return this.threeObject.rotation},set:function(a){this.threeObject.rotation=a}}),tm.hybrid.ThreeElement.prototype.accessor("rotationX",{get:function(){return this.threeObject.rotation.x},set:function(a){this.threeObject.rotation.x=a}}),tm.hybrid.ThreeElement.prototype.accessor("rotationY",{get:function(){return this.threeObject.rotation.y},set:function(a){this.threeObject.rotation.y=a}}),tm.hybrid.ThreeElement.prototype.accessor("rotationZ",{get:function(){return this.threeObject.rotation.z},set:function(a){this.threeObject.rotation.z=a}}),tm.hybrid.ThreeElement.prototype.accessor("up",{get:function(){return this.threeObject.up},set:function(a){this.threeObject.up=a}}),tm.hybrid.ThreeElement.prototype.accessor("useQuaternion",{get:function(){return this.threeObject.useQuaternion},set:function(a){this.threeObject.useQuaternion=a}}),tm.hybrid.ThreeElement.prototype.accessor("quaternion",{get:function(){return this.threeObject.quaternion},set:function(a){this.threeObject.quaternion=a}}),tm.hybrid.ThreeElement.prototype.accessor("visible",{get:function(){return this.threeObject.visible},set:function(a){this.threeObject.visible=a}}),tm.hybrid.ThreeElement.prototype.lookAt=function(a){this.threeObject.lookAt(a.threeObject.position)},tm.define("tm.hybrid.Mesh",{superClass:"tm.hybrid.ThreeElement",init:function(a){if(this.superInit(),"string"==typeof a){var b=tm.asset.Manager.get(a);b?this.threeObject=b.mesh:console.error("アセット'{0}'がないよ".format(a))}else a instanceof THREE.Mesh&&(this.threeObject=a)}}),tm.define("tm.hybrid.Camera",{superClass:"tm.hybrid.ThreeElement",init:function(){this.superInit(),this.threeObject=new THREE.PerspectiveCamera(40,.75,1,1e4)}}),tm.hybrid.Camera.prototype.accessor("fov",{get:function(){return this.threeObject.fov},set:function(a){this.threeObject.fov=a}}),tm.hybrid.Camera.prototype.accessor("aspect",{get:function(){return this.threeObject.aspect},set:function(a){this.threeObject.aspect=a}}),tm.main(function(){gls3.app=tm.hybrid.HybridApp(),tm.dom.Element("body").prepend(tm.dom.Element(gls3.app.element)).prepend(tm.dom.Element(gls3.app.threeCanvas)),gls3.app.fps=60,gls3.app.resize(gls3.W,gls3.H).fitWindow(),gls3.app.pushScene(tm.ui.LoadingScene({nextScene:Main,width:gls3.W,height:gls3.H,assets:gls3.assets})),gls3.app.run()}),tm.define("Main",{superClass:"tm.hybrid.HybridScene",init:function(){this.superInit(),this.fromJSON({children:{bg:{type:"tm.display.RectangleShape",init:[gls3.W,gls3.H,{fillStyle:"black",strokeStyle:"transparent"}],alpha:.5,originX:0,originY:0},tltleLabel:{type:"tm.display.Label",init:["This is Main scene.",36],x:.5*gls3.W,y:.25*gls3.H,fontFamily:"titleFont"},uiLabel:{type:"tm.display.Label",init:["This is Main scene.",36],x:.5*gls3.W,y:.5*gls3.H,fontFamily:"uiFont"},numberLabel:{type:"tm.display.Label",init:["1234567890",36],x:.5*gls3.W,y:.75*gls3.H,fontFamily:"numberFont"}}}),this.three.camera.aspect=gls3.W/gls3.H,this.three.camera.z=20;var a=tm.hybrid.Mesh("test").addChildTo(this.three).on("enterframe",function(a){var b=a.app.keyboard,c=b.getKeyDirection().mul(.2);this.x+=c.x,this.y-=c.y}),b=this.three.camera;b.from=(new THREE.Quaternion).copy(b.quaternion),b.to=(new THREE.Quaternion).copy(b.quaternion),b.step=0;var c=new THREE.Matrix4;b.on("enterframe",function(b){return b.app.frame%200!==0?void THREE.Quaternion.slerp(this.from,this.to,this.quaternion,this.step):(c.lookAt(this.position,a.position,this.up),this.from.copy(this.quaternion),this.to.setFromRotationMatrix(c),void this.tweener.clear().set({step:0}).to({step:1},3e3,"easeInOutQuad"))})}});
//# sourceMappingURL=glshooter3.min.js.map