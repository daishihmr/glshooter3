/*
 * webgl shooting game v0.0.0
 * http://www.dev7.jp
 * 
 * The MIT License (MIT)
 * Copyright © 2014 daishi_hmr, dev7.jp
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy of this software and
 * associated documentation files (the “Software”), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies
 * of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following
 * conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all copies or substantial portions
 * of the Software.
 * 
 * THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */


var gls3={};gls3.W=360,gls3.H=480,gls3.assets={titleFont:"fonts/Teko/Teko-Bold.ttf",uiFont:"fonts/Oxygen/Oxygen-Regular.ttf",numberFont:"fonts/UbuntuMono/UbuntuMono-Bold.ttf",building:{url:"images/building.js",type:"three"}},tm.define("tm.asset.WebFont",{superClass:"tm.event.EventDispatcher",init:function(a,b){this.superInit();var c=tm.dom.Element("body").create("span");c.style.set("fontFamily","'{0}', 'monospace'".format(b)).set("color","rgba(0, 0, 0, 0)").set("fontSize","40px"),c.text="QW@HhsXJ=/()あいうえお＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝";var d=c.element.offsetWidth,e=tm.dom.Element("head").create("style");e.text="@font-face { font-family: '{0}'; src: url({1}) format('truetype'); }".format(b,a);var f=function(){c.element.offsetWidth!==d?(c.remove(),this.flare("load"),console.debug("webfont loaded",a,b)):setTimeout(f,100)}.bind(this);setTimeout(f,100)}}),tm.asset.Loader.register("ttf",function(a,b){var c=tm.asset.WebFont(a,b);return c}),tm.define("tm.asset.ThreeJSON",{superClass:"tm.event.EventDispatcher",init:function(a){this.superInit(),this.mesh=null,null===tm.asset.ThreeJSON.loader&&(tm.asset.ThreeJSON.loader=new THREE.JSONLoader),tm.asset.ThreeJSON.loader.load(a,function(a,b){this.load(a,b),this.flare("load")}.bind(this))},load:function(a,b){b[0].shading=THREE.FlatShading,this.mesh=new THREE.Mesh(a,new THREE.MeshFaceMaterial(b))}}),tm.asset.ThreeJSON.loader=null,tm.asset.Loader.register("three",function(a){var b=tm.asset.ThreeJSON(a);return b}),tm.define("tm.hybrid.HybridApp",{superClass:"tm.display.CanvasApp",init:function(a){this.superInit(a),this.setupThree(),this.background="transparent"},setupThree:function(){this.threeRenderer=new THREE.WebGLRenderer({antialias:!0}),this.element.parentNode&&this.element.parentNode.appendChild(this.threeRenderer.domElement),this.threeCanvas=this.threeRenderer.domElement},fitWindow:function(a){var b=function(){a=void 0===a?!0:a;var b=this.threeCanvas,c=b.style;c.position="absolute",c.margin="auto",c.left="0px",c.top="0px",c.bottom="0px",c.right="0px";var d=b.width/window.innerWidth,e=b.height/window.innerHeight,f=b.height/b.width;d>e?(c.width=innerWidth+"px",c.height=innerWidth*f+"px"):(c.width=innerHeight/f+"px",c.height=innerHeight+"px")}.bind(this);return b(),a&&window.addEventListener("resize",b,!1),tm.display.CanvasApp.prototype.fitWindow.call(this,a)},_update:function(){tm.app.BaseApp.prototype._update.call(this);var a=this.currentScene;this.awake&&a instanceof tm.hybrid.HybridScene&&(this.updater.update(a.three.camera),this.updater.update(a.three))},_draw:function(){tm.display.CanvasApp.prototype._draw.call(this);var a=this.currentScene;a instanceof tm.hybrid.HybridScene&&a.render(this.threeRenderer)},resize:function(a,b){this.threeRenderer.setSize(a,b);var c=this.currentScene;return c instanceof tm.hybrid.HybridScene&&(c.three.camera.aspect=a/b),tm.display.CanvasApp.prototype.resize.call(this,a,b)}}),tm.define("tm.hybrid.HybridScene",{superClass:"tm.app.Scene",init:function(){this.superInit(),this.two=this,this.three=tm.hybrid.HybridScene.Three(),this.effectComposer=null,this.on("enter",function(a){this.camera.aspect=a.app.width/a.app.height})},render:function(a){a.render(this.three.scene,this.three.camera.threeObject)}}),tm.hybrid.HybridScene.prototype.accessor("camera",{get:function(){return this.three.camera},set:function(a){this.three.camera=a}}),tm.hybrid.HybridScene.prototype.accessor("ambientLight",{get:function(){return this.three.ambientLight},set:function(a){this.three.ambientLight=a}}),tm.hybrid.HybridScene.prototype.accessor("directionalLight",{get:function(){return this.three.directionalLight},set:function(a){this.three.directionalLight=a}}),tm.define("tm.hybrid.HybridScene.Three",{superClass:"tm.hybrid.ThreeElement",init:function(){this.superInit(new THREE.Scene),this.scene=this.threeObject,this.camera=tm.hybrid.Camera(),this.camera.z=7,this.ambientLight=new THREE.AmbientLight(16777215),this.scene.add(this.ambientLight),this.directionalLight=new THREE.DirectionalLight(16777215),this.directionalLight.position.set(1,1,1).normalize(),this.scene.add(this.directionalLight)}}),tm.hybrid.HybridScene.prototype.accessor("fog",{get:function(){return this.three.scene.fog},set:function(a){this.three.scene.fog=a}}),tm.hybrid.HybridScene.prototype.accessor("overrideMaterial",{get:function(){return this.three.scene.overrideMaterial},set:function(a){this.three.scene.overrideMaterial=a}}),tm.hybrid.HybridScene.prototype.accessor("autoUpdate",{get:function(){return this.three.scene.autoUpdate},set:function(a){this.three.scene.autoUpdate=a}}),tm.define("tm.hybrid.ThreeElement",{superClass:"tm.app.Element",init:function(a){this.superInit(),this.threeObject=a||new THREE.Object3D},addChild:function(a){a.parent&&a.remove(),a.parent=this,this.children.push(a),a instanceof tm.hybrid.ThreeElement&&this.threeObject.add(a.threeObject);var b=tm.event.Event("added");return a.dispatchEvent(b),a},removeChild:function(a){var b=this.children.indexOf(a);if(-1!=b){this.children.splice(b,1),a instanceof tm.hybrid.ThreeElement&&this.threeObject.remove(a.threeObject);var c=tm.event.Event("removed");a.dispatchEvent(c)}},setPosition:function(a,b,c){return this.x=a,this.y=b,this.z=c,this},setRotation:function(a,b,c){return this.rotationX=a,this.rotationY=b,this.rotationZ=c,this},setScale:function(a,b,c){return 1===arguments.length&&(b=a,c=a),this.scaleX=a,this.sclaeY=b,this.scaleZ=c,this},show:function(){return this.visible=!0,this},hide:function(){return this.visible=!1,this},setVisible:function(a){return this.visible=a,this}}),tm.hybrid.ThreeElement.prototype.accessor("id",{get:function(){return this.threeObject.id},set:function(a){this.threeObject.id=a}}),tm.hybrid.ThreeElement.prototype.accessor("uuid",{get:function(){return this.threeObject.uuid},set:function(a){this.threeObject.uuid=a}}),tm.hybrid.ThreeElement.prototype.accessor("name",{get:function(){return this.threeObject.name},set:function(a){this.threeObject.name=a}}),tm.hybrid.ThreeElement.prototype.accessor("position",{get:function(){return this.threeObject.position},set:function(a){this.threeObject.position=a}}),tm.hybrid.ThreeElement.prototype.accessor("x",{get:function(){return this.threeObject.position.x},set:function(a){this.threeObject.position.x=a}}),tm.hybrid.ThreeElement.prototype.accessor("y",{get:function(){return this.threeObject.position.y},set:function(a){this.threeObject.position.y=a}}),tm.hybrid.ThreeElement.prototype.accessor("z",{get:function(){return this.threeObject.position.z},set:function(a){this.threeObject.position.z=a}}),tm.hybrid.ThreeElement.prototype.accessor("scale",{get:function(){return this.threeObject.scale},set:function(a){this.threeObject.scale=a}}),tm.hybrid.ThreeElement.prototype.accessor("scaleX",{get:function(){return this.threeObject.scale.x},set:function(a){this.threeObject.scale.x=a}}),tm.hybrid.ThreeElement.prototype.accessor("scaleY",{get:function(){return this.threeObject.scale.y},set:function(a){this.threeObject.scale.y=a}}),tm.hybrid.ThreeElement.prototype.accessor("scaleZ",{get:function(){return this.threeObject.scale.z},set:function(a){this.threeObject.scale.z=a}}),tm.hybrid.ThreeElement.prototype.accessor("rotation",{get:function(){return this.threeObject.rotation},set:function(a){this.threeObject.rotation=a}}),tm.hybrid.ThreeElement.prototype.accessor("eulerOrder",{get:function(){return this.threeObject.eulerOrder},set:function(a){this.threeObject.eulerOrder=a}}),tm.hybrid.ThreeElement.prototype.accessor("rotationX",{get:function(){return this.threeObject.rotation.x*Math.RAD_TO_DEG},set:function(a){this.threeObject.rotation.x=a*Math.DEG_TO_RAD}}),tm.hybrid.ThreeElement.prototype.accessor("rotationY",{get:function(){return this.threeObject.rotation.y*Math.RAD_TO_DEG},set:function(a){this.threeObject.rotation.y=a*Math.DEG_TO_RAD}}),tm.hybrid.ThreeElement.prototype.accessor("rotationZ",{get:function(){return this.threeObject.rotation.z*Math.RAD_TO_DEG},set:function(a){this.threeObject.rotation.z=a*Math.DEG_TO_RAD}}),tm.hybrid.ThreeElement.prototype.accessor("up",{get:function(){return this.threeObject.up},set:function(a){this.threeObject.up=a}}),tm.hybrid.ThreeElement.prototype.accessor("useQuaternion",{get:function(){return this.threeObject.useQuaternion},set:function(a){this.threeObject.useQuaternion=a}}),tm.hybrid.ThreeElement.prototype.accessor("quaternion",{get:function(){return this.threeObject.quaternion},set:function(a){this.threeObject.quaternion=a}}),tm.hybrid.ThreeElement.prototype.accessor("visible",{get:function(){return this.threeObject.visible},set:function(a){this.threeObject.visible=a}}),tm.hybrid.ThreeElement.prototype.accessor("castShadow",{get:function(){return this.threeObject.castShadow},set:function(a){this.threeObject.castShadow=a}}),tm.hybrid.ThreeElement.prototype.accessor("receiveShadow",{get:function(){return this.threeObject.receiveShadow},set:function(a){this.threeObject.receiveShadow=a}}),tm.hybrid.ThreeElement.prototype.accessor("frustumCulled",{get:function(){return this.threeObject.frustumCulled},set:function(a){this.threeObject.frustumCulled=a}}),tm.hybrid.ThreeElement.prototype.accessor("matrixAutoUpdate",{get:function(){return this.threeObject.matrixAutoUpdate},set:function(a){this.threeObject.matrixAutoUpdate=a}}),tm.hybrid.ThreeElement.prototype.accessor("matrixWorldNeedsUpdate",{get:function(){return this.threeObject.matrixWorldNeedsUpdate},set:function(a){this.threeObject.matrixWorldNeedsUpdate=a}}),tm.hybrid.ThreeElement.prototype.accessor("rotationAutoUpdate",{get:function(){return this.threeObject.rotationAutoUpdate},set:function(a){this.threeObject.rotationAutoUpdate=a}}),tm.hybrid.ThreeElement.prototype.accessor("userData",{get:function(){return this.threeObject.userData},set:function(a){this.threeObject.userData=a}}),tm.hybrid.ThreeElement.prototype.accessor("matrixWorld",{get:function(){return this.threeObject.matrixWorld},set:function(a){this.threeObject.matrixWorld=a}}),tm.hybrid.ThreeElement.prototype.applyMatrix=function(a){return this.threeObject.applyMatrix(a),this},tm.hybrid.ThreeElement.prototype.translateX=function(a){return this.threeObject.translateX(a),this},tm.hybrid.ThreeElement.prototype.translateY=function(a){return this.threeObject.translateY(a),this},tm.hybrid.ThreeElement.prototype.translateZ=function(a){return this.threeObject.translateZ(a),this},tm.hybrid.ThreeElement.prototype.localToWorld=function(a){return this.threeObject.localToWorld(a),this},tm.hybrid.ThreeElement.prototype.worldToLocal=function(a){return this.threeObject.worldToLocal(a),this},tm.hybrid.ThreeElement.prototype.lookAt=function(a){return this.threeObject.lookAt(a),this},tm.hybrid.ThreeElement.prototype.updateMatrix=function(){return this.threeObject.updateMatrix(),this},tm.hybrid.ThreeElement.prototype.updateMatrixWorld=function(a){return this.threeObject.updateMatrixWorld(a),this},tm.hybrid.ThreeElement.prototype.getObjectByName=function(a,b){return this.threeObject.getObjectByName(a,b)},tm.hybrid.ThreeElement.prototype.getObjectById=function(a,b){return this.threeObject.getObjectById(a,b)},tm.hybrid.ThreeElement.prototype.translateOnAxis=function(a,b){return this.threeObject.translateOnAxis(a,b)},tm.hybrid.ThreeElement.prototype.rotateOnAxis=function(a,b){return this.threeObject.rotateOnAxis(a,b)},tm.define("tm.hybrid.Camera",{superClass:"tm.hybrid.ThreeElement",init:function(){this.superInit(new THREE.PerspectiveCamera(40,1,1,1e4))}}),tm.hybrid.Camera.prototype.accessor("matrixWorldInverse",{get:function(){return this.threeObject.matrixWorldInverse},set:function(a){this.threeObject.matrixWorldInverse=a}}),tm.hybrid.Camera.prototype.accessor("projectionMatrix",{get:function(){return this.threeObject.projectionMatrix},set:function(a){this.threeObject.projectionMatrix=a}}),tm.hybrid.Camera.prototype.accessor("fov",{get:function(){return this.threeObject.fov},set:function(a){this.threeObject.fov=a,this.threeObject.updateProjectionMatrix()}}),tm.hybrid.Camera.prototype.accessor("aspect",{get:function(){return this.threeObject.aspect},set:function(a){this.threeObject.aspect=a,this.threeObject.updateProjectionMatrix()}}),tm.hybrid.Camera.prototype.accessor("near",{get:function(){return this.threeObject.near},set:function(a){this.threeObject.near=a,this.threeObject.updateProjectionMatrix()}}),tm.hybrid.Camera.prototype.accessor("far",{get:function(){return this.threeObject.far},set:function(a){this.threeObject.far=a,this.threeObject.updateProjectionMatrix()}}),tm.define("tm.hybrid.Mesh",{superClass:"tm.hybrid.ThreeElement",init:function(a){if("string"==typeof a){var b=tm.asset.Manager.get(a);b?this.superInit(b.mesh.clone()):console.error("アセット'{0}'がないよ".format(a))}else a instanceof THREE.Mesh&&this.superInit(a)}}),tm.hybrid.Mesh.prototype.getMorphTargetIndexByName=function(a){return this.threeObject.getMorphTargetIndexByName(a),this},tm.hybrid.Mesh.prototype.updateMorphTargets=function(){return this.threeObject.updateMorphTargets(),this},tm.define("tm.hybrid.Sprite",{superClass:"tm.hybrid.ThreeElement",init:function(a,b,c){"string"==typeof a?this.texture=tm.asset.Manager.get(a):a?this.texture=a:console.error("アセット'{0}'がないよ".format(a)),b=b||1,c=c||1,this.superInit()}}),tm.define("gls3.GameScene",{superClass:"tm.hybrid.HybridScene",init:function(){this.superInit(),this.on("enter",function(a){var b=this.effectComposer=new THREE.EffectComposer(a.app.threeRenderer);b.addPass(new THREE.RenderPass(this.three.scene,this.three.camera.threeObject),new THREE.WebGLRenderTarget(a.app.width,a.app.height,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat,stencilBuffer:!1}));var c=new THREE.ShaderPass(THREE.CopyShader);b.addPass(c),c.renderToScreen=!0})},render:function(){this.effectComposer.render()}}),tm.main(function(){tm.dom.Element("body").style.set("backgroundColor","hsl(240, 40%, 10%)"),gls3.app=tm.hybrid.HybridApp(),tm.util.Script.loadStats().on("load",function(){gls3.app.enableStats()});var a=tm.dom.Element(gls3.app.element),b=tm.dom.Element(gls3.app.threeCanvas);b.style.set("backgroundColor","black"),tm.dom.Element("body").prepend(a).prepend(b),gls3.app.fps=60,gls3.app.resize(gls3.W,gls3.H).fitWindow(),gls3.app.pushScene(tm.ui.LoadingScene({nextScene:Main,width:gls3.W,height:gls3.H,assets:gls3.assets})),gls3.app.run()}),tm.define("Main",{superClass:"gls3.GameScene",init:function(){var a=this;this.superInit(),this.fromJSON({children:{tltleLabel:{type:"tm.display.Label",init:["This is Main scene.",36],fillStyle:"hsl(20, 80%, 60%)",x:.5*gls3.W,y:.25*gls3.H,fontFamily:"titleFont"},uiLabel:{type:"tm.display.Label",init:["This is Main scene.",36],fillStyle:"hsl(20, 80%, 60%)",x:.5*gls3.W,y:.5*gls3.H,fontFamily:"uiFont"},numberLabel:{type:"tm.display.Label",init:["1234567890",36],fillStyle:"hsl(20, 80%, 60%)",x:.5*gls3.W,y:.75*gls3.H,fontFamily:"numberFont"}}});var b=tm.hybrid.ThreeElement().addChildTo(a.three).setRotation(0,0,20).on("enterframe",function(a){this.rotationY+=.2;var b=a.app.keyboard,c=b.getKeyDirection().mul(.2);this.x+=c.x,this.y-=c.y});20..times(function(a){10..times(function(c){var d=tm.hybrid.Mesh("building").setPosition(4*(c-5),0,-4*(a-10)).addChildTo(b);d.threeObject.material.materials.each(function(a){a.transparent=!0,a.opacity=[.5,1].pickup()})})});var c=this.camera;c.y=5,c.z=50,c.from=(new THREE.Quaternion).copy(c.quaternion),c.to=(new THREE.Quaternion).copy(c.quaternion),c.step=0,c.on("enterframe",function(){THREE.Quaternion.slerp(this.from,this.to,this.quaternion,this.step)});var d=new THREE.Matrix4;this.update=function(a){(a.keyboard.getKeyUp("up")||a.keyboard.getKeyUp("down")||a.keyboard.getKeyUp("left")||a.keyboard.getKeyUp("right"))&&c.tweener.clear().call(function(){d.lookAt(c.position,b.position,c.up),c.from.copy(c.quaternion),c.to.setFromRotationMatrix(d)}).set({step:0}).to({step:1},1e3,"easeInOutQuad")},THREE.ImageUtils.loadTexture("./images/fighters.png",null,function(b){b.offset.x=0,b.offset.y=.8,b.repeat.x=1/7,b.repeat.y=.2;var c=new THREE.SpriteMaterial({map:b,color:16777215,depthTest:!1}),d=new THREE.Sprite(c);d.scale.set(5,5,1),tm.hybrid.ThreeElement(d).on("enterframe",function(){}).addChildTo(a.three)});for(var e=new THREE.SplineCurve3([new THREE.Vector3(0,0,0),new THREE.Vector3(0,20,0),new THREE.Vector3(15,15,-30),new THREE.Vector3(15,5,0),new THREE.Vector3(25,10,0),new THREE.Vector3(25,30,0)]),f=new THREE.LineBasicMaterial({color:16711920}),g=new THREE.Geometry,h=e.getPoints(100),i=0;i<h.length;i++)g.vertices.push(h[i]);tm.hybrid.ThreeElement(new THREE.Line(g,f)).on("enterframe",function(){this.rotationY+=.02}).addChildTo(a.three)}});
//# sourceMappingURL=glshooter3.min.js.map